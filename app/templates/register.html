{% extends "base.html" %}

{% block content %}
<h2>Register</h2>

{% if error %}
    <div class="error-message" id="server-error">
        {{ error }}
    </div>
{% endif %}

<form id="registerForm" action="/auth/register" method="post" class="form-box">
    <input type="text" name="username" id="username" placeholder="Choose a username" required value="{{ username or '' }}">
    <div id="username-error" class="field-error"></div>

    <input type="password" name="password" id="password" placeholder="Choose a password" required>
    <div id="password-error" class="field-error"></div>

    <input type="password" name="confirm_password" id="confirm_password" placeholder="Confirm password" required>
    <div id="confirm-password-error" class="field-error"></div>

    <button type="submit">Register</button>
</form>

<p>Already have an account? <a href="/auth/login">Login here</a>.</p>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const registerForm = document.getElementById('registerForm');
    if (registerForm) {
        registerForm.addEventListener('submit', function(event) {
            let isValid = true;
            
            // 清空之前的错误信息
            document.querySelectorAll('.field-error').forEach(el => {
                el.textContent = '';
                el.classList.remove('error');
            });
            
            // 验证用户名
            const username = document.getElementById('username').value.trim();
            const usernameInput = document.getElementById('username');
            const usernameError = document.getElementById('username-error');
            
            if (!username) {
                usernameError.textContent = 'Username is required';
                usernameInput.classList.add('error');
                isValid = false;
            } else if (username.length > 100) {
                usernameError.textContent = 'Username too long (max 100 characters)';
                usernameInput.classList.add('error');
                isValid = false;
            } else {
                usernameInput.classList.remove('error');
            }
            
            // 验证密码
            const password = document.getElementById('password').value;
            const passwordInput = document.getElementById('password');
            const passwordError = document.getElementById('password-error');
            
            if (!password) {
                passwordError.textContent = 'Password is required';
                passwordInput.classList.add('error');
                isValid = false;
            } else if (password.length < 6) {
                passwordError.textContent = 'Password must be at least 6 characters';
                passwordInput.classList.add('error');
                isValid = false;
            } else if (password.length > 128) {
                passwordError.textContent = 'Password too long (max 128 characters)';
                passwordInput.classList.add('error');
                isValid = false;
            } else {
                passwordInput.classList.remove('error');
            }
            
            // 验证确认密码
            const confirmPassword = document.getElementById('confirm_password').value;
            const confirmPasswordInput = document.getElementById('confirm_password');
            const confirmPasswordError = document.getElementById('confirm-password-error');
            
            if (password !== confirmPassword) {
                confirmPasswordError.textContent = 'Passwords do not match';
                confirmPasswordInput.classList.add('error');
                isValid = false;
            } else {
                confirmPasswordInput.classList.remove('error');
            }
            
            if (!isValid) {
                event.preventDefault();
            }
        });
    }
});
</script>

<style>
.field-error {
    color: #d32f2f;
    font-size: 12px;
    margin-top: 2px;
    margin-bottom: 8px;
    min-height: 16px;
}

.error-message {
    background-color: #f8d7da;
    color: #721c24;
    padding: 12px;
    border-radius: 4px;
    margin: 15px 0;
    border: 1px solid #f5c6cb;
}

.form-box input.error {
    border-color: #d32f2f;
    border-width: 2px;
}
</style>

{% endblock %}